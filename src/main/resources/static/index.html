<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sankalp's Todo</title>

    <style>
        :root {
            --bg: #f7f9f8;
            --card: #ffffff;
            --text: #2c3e50;
            --muted: #7f8c8d;
            --primary: #5f8d89;
            --accent: #6c7aaf;
            --danger: #d96c6c;
            --border: #e6ecea;
        }

        body.dark {
            --bg: #1e2326;
            --card: #2b3136;
            --text: #ecf0f1;
            --muted: #95a5a6;
            --border: #3a4045;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            padding: 60px 15px;
            transition: 0.3s ease;
        }

        .container {
            width: 100%;
            max-width: 550px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        h1 {
            font-weight: 600;
            font-size: 22px;
            margin: 0;
        }

        .mode-toggle {
            cursor: pointer;
            font-size: 14px;
            color: var(--muted);
        }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 18px;
        }

        .input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 18px;
        }

        input {
            flex: 1;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            outline: none;
            font-size: 14px;
            background: transparent;
            color: var(--text);
        }

        button {
            padding: 9px 14px;
            border-radius: 8px;
            border: none;
            font-size: 13px;
            cursor: pointer;
            transition: 0.2s ease;
        }

        .add-btn {
            background: var(--primary);
            color: white;
        }

        .edit-btn {
            background: var(--accent);
            color: white;
        }

        .delete-btn {
            background: var(--danger);
            color: white;
        }

        .complete-btn {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        button:hover {
            opacity: 0.85;
        }

        .filters {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .filters button {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--muted);
        }

        .filters button.active {
            border-color: var(--primary);
            color: var(--primary);
        }

        ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 10px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }

        li:last-child {
            border-bottom: none;
        }

        .completed {
            text-decoration: line-through;
            color: var(--muted);
        }

        .task-actions {
            display: flex;
            gap: 6px;
        }
    </style>
</head>

<body>

<div class="container">
    <div class="header">
        <h1>Todo</h1>
        <div class="mode-toggle" onclick="toggleMode()">Toggle Mode</div>
    </div>

    <div class="card">
        <div class="input-row">
            <input type="text" id="titleInput" placeholder="Add a task...">
            <button class="add-btn" onclick="addTodo()">Add</button>
        </div>

        <div class="filters">
            <button onclick="setFilter('all')" id="filter-all" class="active">All</button>
            <button onclick="setFilter('completed')" id="filter-completed">Completed</button>
            <button onclick="setFilter('pending')" id="filter-pending">Pending</button>
        </div>

        <ul id="todoList"></ul>
    </div>
</div>

<script>
    const BASE_URL = "/todo";
    let currentFilter = "all";

    function toggleMode() {
        document.body.classList.toggle("dark");
        localStorage.setItem("mode", document.body.classList.contains("dark"));
    }

    if (localStorage.getItem("mode") === "true") {
        document.body.classList.add("dark");
    }

    async function fetchTodos() {
        const res = await fetch(BASE_URL + "/show");
        const data = await res.json();
        const list = document.getElementById("todoList");
        list.innerHTML = "";

        data
        .filter(todo => {
            if (currentFilter === "completed") return todo.completed;
            if (currentFilter === "pending") return !todo.completed;
            return true;
        })
        .forEach(todo => {
            const li = document.createElement("li");

            const span = document.createElement("span");
            span.textContent = todo.title;
            if (todo.completed) span.classList.add("completed");

            const actions = document.createElement("div");
            actions.className = "task-actions";

            const completeBtn = document.createElement("button");
            completeBtn.textContent = "Complete";
            completeBtn.className = "complete-btn";
            completeBtn.onclick = () => toggleComplete(todo.id, !todo.completed);

            const editBtn = document.createElement("button");
            editBtn.textContent = "Edit";
            editBtn.className = "edit-btn";
            editBtn.onclick = () => editTodo(todo.id, todo.title);

            const deleteBtn = document.createElement("button");
            deleteBtn.textContent = "Delete";
            deleteBtn.className = "delete-btn";
            deleteBtn.onclick = () => deleteTodo(todo.id);

            actions.append(completeBtn, editBtn, deleteBtn);
            li.append(span, actions);
            list.appendChild(li);
        });
    }

    async function addTodo() {
        const title = document.getElementById("titleInput").value;
        if (!title) return;

        await fetch(BASE_URL + "/create", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ title })
        });

        document.getElementById("titleInput").value = "";
        fetchTodos();
    }

    async function editTodo(id, oldTitle) {
        const newTitle = prompt("Edit task:", oldTitle);
        if (!newTitle) return;

        await fetch(BASE_URL + "/update/" + id, {
            method: "PATCH",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ title: newTitle })
        });

        fetchTodos();
    }

    async function toggleComplete(id, status) {
        await fetch(BASE_URL + "/update/" + id, {
            method: "PATCH",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ completed: status })
        });

        fetchTodos();
    }

    async function deleteTodo(id) {
        await fetch(BASE_URL + "/delete/" + id, {
            method: "DELETE"
        });
        fetchTodos();
    }

    function setFilter(filter) {
        currentFilter = filter;

        document.querySelectorAll(".filters button").forEach(btn =>
            btn.classList.remove("active")
        );

        document.getElementById("filter-" + filter).classList.add("active");

        fetchTodos();
    }

    fetchTodos();
</script>

</body>
</html>